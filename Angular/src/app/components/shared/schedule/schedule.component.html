<div class="calendar-container">
  <div class="calendar">
    <div class="calendar-header">
      <div class="calendar-header-month">
          {{firstDayOfActiveMonth().monthShort}}
          {{firstDayOfActiveMonth().year}}
      </div>
      <div class="calendar-header-controls">
        <button mat-raised-button color="primary" (click)="goToPreviousMonth()"><mat-icon>arrow_back_ios_new</mat-icon></button>
        <button mat-raised-button color="accent" (click)="goToToday()">{{currentMonth}}</button>
        <button mat-raised-button color="primary" (click)="goToNextMonth()"><mat-icon>arrow_forward_ios_new</mat-icon></button>
      </div>
    </div>
    <div class="calendar-weeks-grid">
      @for (weekDay of weekDays(); track $index) {
        <div class="calnedar-weeks-grid-cell">{{weekDay}}</div>
      }
    </div>
    <div class="calendar-grid">
      @for (dayOfMonth of daysOfMonth(); track $index) {
        <div [ngClass]="{ 
          'calendar-grid-cell': true, 
          'calendar-grid-cell-active': activeDay()?.toISODate() === dayOfMonth.toISODate(),
          'calendar-grid-cell-inactive': dayOfMonth.month !== firstDayOfActiveMonth().month,
          'calendar-grid-cell-has-classes': hasClassesForDay(dayOfMonth)}" (click)="activeDay.set(dayOfMonth)">{{dayOfMonth.day}}</div>
      }
    </div>
  </div>
  <div class="schedule">
    <div *ngIf="activeDay(); else noDateSelected">
      <h3>{{ activeDay()?.toLocaleString(DATE_MED) }}</h3>
    
      <div *ngIf="activeDayClasses().length === 0; else classesAvailable">
        <p>Nie masz żadnych zajęć tego dnia</p>
      </div>
    
      <ng-template #classesAvailable>
        <mat-card 
          *ngFor="let class of activeDayClasses(); trackBy: trackByFn"
          class="class-card"
          [ngClass]="{ 'class-canceled': class.isCanceled }"
          (click) = '!isReadOnly && openDetailsDialog(class)'>
          <mat-card-title>{{ class.tutoringClass.className }}</mat-card-title>
          <mat-card-content>
            <p>{{ class.classDateFrom.toFormat('HH:mm') }} - {{ class.classDateTo.toFormat('HH:mm') }}</p>
            <p>{{ class.tutoringClass.subject?.subjectName }}</p>
            <p><strong>Online:</strong> {{ class.isOnline ? 'Tak' : 'Nie' }}</p>
            <p *ngIf="class.isCanceled" class="canceled-label">Zajęcia odwołane</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </div>
    
    <ng-template #noDateSelected>
      <p>Proszę wybrać datę</p>
    </ng-template>
</div>